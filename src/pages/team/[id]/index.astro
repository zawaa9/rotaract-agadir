---
import MainLayout from "@/layouts/MainLayout.astro";
import type { GetStaticPaths } from "astro";
import SEO from "@/components/SEO/index.astro";
import { getCollection } from "astro:content";
import defaultImage from "@/assets/images/events.jpg";
import defaultPerson from "@/assets/images/people-placeholder.jpg";
import ImageBackgroundHero from "@/components/ImageBackgroundHero/index.astro";
import { Image } from "astro:assets";
import { render } from "astro:content";
import { SOCIALS_TYPE_MAP } from "@/content/socials";
import Prose from "@/components/Prose/index.astro";
import JoinTheCommunity from "@/components/JoinTheCommunity/index.astro";
import { BackButton } from "@/components/BackButton";

export const getStaticPaths = (async () => {
  const people = await getCollection("people");

  return Promise.all(
    people.map(async (person) => ({
      params: { id: person.id },
      props: {
        person,
      },
    })),
  );
}) satisfies GetStaticPaths;

const { person } = Astro.props;
const { Content } = await render(person);
---

<MainLayout>
  <ImageBackgroundHero
    src={defaultImage}
    alt=""
    blur
    className="h-[80vh] opacity-80"
  />

  <SEO slot="seo" title={person.data.name} />
  <div
    class="my-16 flex h-full flex-1 flex-col justify-between gap-32 md:my-16"
  >
    <div class="mx-auto flex max-w-screen-md flex-col gap-6">
      <div class="px-4">
        <BackButton client:load href="/team" contextLabel="Club Members" />
      </div>
      <div class="flex flex-col justify-center gap-8 md:flex-row">
        <section
          class="flex w-full flex-[0.5] flex-col items-center gap-4 px-4 md:sticky md:top-24 md:items-start md:self-start"
        >
          <div class="aspect-square size-56 flex-none rounded-lg">
            <Image
              src={person.data.avatar ?? defaultPerson}
              alt={`${person.data.name} profile picture`}
              width={300}
              height={300}
              class="h-full w-full object-contain"
            />
          </div>
          <div class="flex flex-col gap-2 text-center md:text-left">
            <h1
              class="text-md line-clamp-3 font-heading font-medium tracking-wide"
            >
              {person.data.name}
            </h1>

            <div class="flex flex-col gap-1">
              {
                person.data.clubRole && (
                  <span class="w-fit rounded bg-primary px-2 py-1 text-xs font-bold uppercase leading-none text-black">
                    {person.data.clubRole}
                  </span>
                )
              }
              {
                person.data.job && (
                  <p class="line-clamp-3 text-xs tracking-wide opacity-60">
                    {person.data.job}
                  </p>
                )
              }
            </div>
          </div>

          {
            !!person.data.socials && (
              <ul class="flex flex-row gap-4">
                {person.data.socials.map((social) => {
                  const Icon = SOCIALS_TYPE_MAP[social.type];

                  return (
                    <li>
                      <a
                        href={social.href}
                        class="text-lg opacity-60 transition hover:text-primary hover:opacity-100"
                        target="_blank"
                      >
                        <span class="sr-only">{social.type}</span>
                        <Icon />
                      </a>
                    </li>
                  );
                })}
              </ul>
            )
          }
        </section>

        <section class="flex w-full flex-1 flex-col gap-8 px-4">
          {
            !!person.body && (
              <div class="flex flex-col gap-4">
                <h2 class="w-full font-heading text-xl uppercase tracking-wider">
                  About {person.data.name}
                </h2>
                <Prose class="prose-sm">
                  <Content />
                </Prose>
              </div>
            )
          }
        </section>
      </div>
    </div>

    <JoinTheCommunity />
  </div>
</MainLayout>
