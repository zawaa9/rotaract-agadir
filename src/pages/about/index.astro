---
import MainPageTitle from "@/components/MainPageTitle/index.astro";
import MainLayout from "@/layouts/MainLayout.astro";
import People from "@/components/People/index.astro";
import SEO from "@/components/SEO/index.astro";
import PartnersBlock from "@/components/PartnersBlock/index.astro";
import { HOME_CONFIG } from "@/content/home";
import JoinTheCommunity from "@/components/JoinTheCommunity/index.astro";
import Prose from "@/components/Prose/index.astro";
import { getEntries } from "astro:content";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

const ROLE_ORDER = [
  "president",
  "ipp",
  "vice-president",
  "secretary",
  "sergeant at arms",
];

const normalizeRole = (role?: string) => {
  if (!role) return undefined;
  const r = role.toLowerCase().trim();
  if (r.includes("immediate past president") || r.includes("ipp")) return "ipp";
  if (r.includes("vice-president") || r.includes("vice president"))
    return "vice-president";
  if (r.includes("president")) return "president";
  if (r.includes("secretary")) return "secretary";
  if (r.includes("sergeant at arms") || r.includes("sergent at arms"))
    return "sergeant at arms";
  return undefined;
};

const getRoleRank = (role?: string) => {
  const cat = normalizeRole(role);
  if (!cat) return Number.POSITIVE_INFINITY;
  const idx = ROLE_ORDER.indexOf(cat);
  return idx === -1 ? ROLE_ORDER.length + 1 : idx;
};

const boardMembers = (
  await getCollection("people", (people) => people.data.isBoardMember === true)
)
  .map((person) => ({
    ...person,
    data: {
      ...person.data,
      avatar: person.data.avatar,
      // We basically just want names and socials at the moment
      job: undefined,
    },
  }))
  .sort((a, b) => {
    const rankA = getRoleRank(a.data.clubRole);
    const rankB = getRoleRank(b.data.clubRole);
    if (rankA !== rankB) return rankA - rankB;
    return a.data.name.localeCompare(b.data.name);
  });

const partners = await getEntries<"partners">(
  (HOME_CONFIG.partners ?? []).map((partner) => ({
    collection: "partners",
    id: partner,
  })),
);
---

<MainLayout>
  <SEO
    slot="seo"
    title="About"
    description="Learn about Rotaract Agadir Atlantique, a youth-led service club in Agadir, Morocco, part of Rotaract District 9010."
  />
  <div class="mx-auto w-full max-w-screen-sm px-4">
    <MainPageTitle
      title="About Rotaract Agadir Atlantique"
      subtitle="Who we are and what we do"
    />

    <!-- Logos Section -->
    <div class="flex items-center justify-center gap-8 py-8">
      <div class="flex flex-col items-center gap-2">
        <Image
          src="/logo-white.png"
          alt="Rotaract Agadir Atlantique Logo"
          width={500}
          height={500}
          class="rounded-lg"
        />
      </div>
      <div class="flex flex-col items-center gap-2">
        <Image
          src="/rac-district.png"
          alt="Rotaract District 9010 Logo"
          width={500}
          height={500}
          class="rounded-lg"
        />
      </div>
    </div>

    <div class="flex flex-col gap-24">
      <Prose>
        <p>
          Rotaract Agadir Atlantique is a youth-led service club bringing
          together students and young professionals to create positive impact in
          Agadir and beyond. It is sponsored by <strong>Rotary Club Agadir Doyen</strong>, 
          and it is part of <strong>Rotaract District 9010</strong>,
          we are connected to a larger network of Rotaract clubs across Morocco
          and North Africa, sharing resources, best practices, and collaborative
          opportunities.
        </p>

        <p>
          We focus on service, leadership, and personal development, working
          closely with our district partners to amplify our impact and reach
          more communities. Our membership in District 9010 enables us to
          participate in district-wide initiatives, leadership training
          programs, and international exchange opportunities.
        </p>

        <p>
          We design and run projects in health awareness, education,
          environment, and social support, while building leadership and
          teamwork skills among members. Through our district affiliation, we
          also contribute to and benefit from regional service projects and
          youth development programs.
        </p>
      </Prose>

      {
        !!boardMembers.length && (
          <div class="flex flex-col gap-8">
            <h2
              id="board-members"
              class="scroll-mt-32 font-heading text-2xl font-medium uppercase tracking-widest"
            >
              Board
            </h2>

            <div class="grid grid-cols-2 gap-x-4 gap-y-6 xs:grid-cols-4">
              {boardMembers.map((boardMember) => (
                <People people={boardMember} />
              ))}
            </div>
          </div>
        )
      }

      <section>
        <Prose>
          <p>
            As Rotaract members, we believe in the power of service above self,
            integrity, inclusivity, and collaboration. We aim to make our
            initiatives accessible and impactful for our local community while
            contributing to the broader goals of District 9010.
          </p>

          <p>
            We organize a variety of <a href="/events">initiatives</a> to engage
            the community, including <strong>awareness campaigns</strong>,
            <strong>charity actions</strong>, <strong>training workshops</strong
            >, and <strong>international exchanges</strong>. Each initiative is
            designed to promote service, collaboration, and leadership, often in
            partnership with other clubs in our district.
          </p>

          <p>
            Our values are simple: service above self, integrity, inclusivity,
            and collaboration. We aim to make initiatives accessible and
            impactful for our local community while building bridges with other
            Rotaract clubs across District 9010.
          </p>

          <p>
            Run by motivated members, we aim to create spaces where everyone can
            contribute, learn, and grow. Whether itâ€™s a local campaign, a
            cross-club exchange, or community support, we invite you to join us
            in creating positive impact both locally and across our district.
          </p></Prose
        >
      </section>
    </div>
  </div>

  <!-- PARTNERS -->
  {
    !!partners.length && (
      <div class="py-12">
        <PartnersBlock partners={partners} />
      </div>
    )
  }

  <div class="py-8 md:py-12">
    <JoinTheCommunity />
  </div>
</MainLayout>
